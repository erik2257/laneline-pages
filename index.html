<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lane-Line Push</title>

  <!-- OneSignal Web SDK v16 (подключаем ОДИН раз) -->
  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>

  <script>
    // Единый блок инициализации (с правильными путями и scope для /laneline-pages/)
    window.OneSignalDeferred = window.OneSignalDeferred || [];
    window.OneSignalDeferred.push(async function (OneSignal) {
      try {
        await OneSignal.init({
          appId: "4d4e6237-e321-4209-a655-faac69188a85",
          // ВАЖНО: абсолютные пути и совпадающий scope для проектного URL
          serviceWorkerPath: "/laneline-pages/OneSignalSDKWorker.js",
          serviceWorkerUpdaterPath: "/laneline-pages/OneSignalSDKUpdaterWorker.js",
          serviceWorkerParam: { scope: "/laneline-pages/" },
          notifyButton: { enable: true } // колокольчик для ручной подписки
        });
      } catch (e) {
        console.error("OneSignal init error:", e);
      }
    });
  </script>

  <style>
    body{font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin:0; padding:24px}
    .box{max-width:720px; margin:0 auto}
    .muted{opacity:.7}
    button{padding:10px 14px; border:0; border-radius:10px; background:#2d6cdf; color:#fff; cursor:pointer}
  </style>
</head>
<body>
  <div class="box">
    <h1>Lane-Line — Web Push</h1>
    <p>Если ты видишь этот текст — страница прогрузилась нормально.</p>
    <p class="muted">Колокольчик OneSignal внизу экрана позволяет подписаться вручную, если баннер не появился.</p>
    <p><button id="permit">Запросить разрешение на уведомления</button></p>
    <p class="muted" id="status">Статус: …</p>
  </div>

  <script>
    // Вспомогательный запрос разрешения и вывод статуса — чтобы наглядно видеть, что происходит
    (function(){
      const $s = document.getElementById('status');
      function set(msg){ if($s) $s.textContent = "Статус: " + msg; }

      window.OneSignalDeferred = window.OneSignalDeferred || [];
      window.OneSignalDeferred.push(async function(OneSignal){
        try {
          // показать текущий статус
          const st = await OneSignal.Notifications.getPermissionStatus();
          set(st);

          // кнопка ручного запроса
          const btn = document.getElementById('permit');
          if (btn) btn.onclick = async () => {
            try {
              const res = await OneSignal.Notifications.requestPermission();
              set(res);
            } catch(e){ set("error: " + (e && e.message || e)); }
          };
        } catch(e){ set("init error: " + (e && e.message || e)); }
      });
    })();
  </script>
</body>
</html>
